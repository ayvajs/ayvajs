var e={d:(t,s)=>{for(var o in s)e.o(s,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:s[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{UE:()=>l,fV:()=>d,ft:()=>g,ni:()=>y,_I:()=>w,ZP:()=>u});const s=class{#e;#t=[];constructor(e){this.#e=e,Object.values(e.axes).forEach((e=>{this[e.name]=this.#s(e.name),e.alias&&(this[e.alias]=this.#s(e.alias))}))}execute(){return this.#e.move(...this.#t)}#s(e){return(...t)=>{if(3===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]&&"function"==typeof t[2])this.#t.push({axis:e,to:t[0],speed:t[1],value:t[2]});else if(2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1])this.#t.push({axis:e,to:t[0],speed:t[1]});else if(2===t.length&&"number"==typeof t[0]&&"function"==typeof t[1])this.#t.push({axis:e,to:t[0],value:t[1]});else if(1===t.length&&"number"==typeof t[0])this.#t.push({axis:e,to:t[0]});else if(2===t.length&&"function"==typeof t[0]&&"number"==typeof t[1])this.#t.push({axis:e,value:t[0],duration:t[1]});else if(1===t.length&&"function"==typeof t[0])this.#t.push({axis:e,value:t[0]});else{if(1!==t.length||"object"!=typeof t[0])throw new Error(`Invalid arguments: ${t}`);this.#t.push({...t[0],axis:e})}return this}}};function o(e,t=0){const s=10**t;return Math.round(s*e)/s}function i(e,t,s){return Math.max(t,Math.min(s,e))}function a(e,t,s){return!(!Number.isFinite(e)||void 0!==t&&e<t||void 0!==s&&e>s)}function r(e,t,s){Object.defineProperty(e,t,{value:s,writeable:!1,configurable:!1,enumerable:!0})}function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function c(e){throw new Error(e)}const h={name:"SR6",defaultAxis:"L0",axes:[{name:"L0",type:"linear",alias:"stroke"},{name:"L1",type:"linear",alias:"forward"},{name:"L2",type:"linear",alias:"left"},{name:"R0",type:"rotation",alias:"twist"},{name:"R1",type:"rotation",alias:"roll"},{name:"R2",type:"rotation",alias:"pitch"},{name:"A0",alias:"valve",type:"auxiliary"},{name:"A1",alias:"suck",type:"auxiliary"},{name:"A2",alias:"lube",type:"auxiliary"},{name:"V0",alias:"vibe0",type:"auxiliary"},{name:"V1",alias:"vibe1",type:"auxiliary"}]};class p{#o=[];#i={};#a=50;#r=new Set;#n=1;#c=1;#h=null;#p=!1;#u;defaultRamp=p.RAMP_COS;static get precision(){return 10}get performing(){return this.#p}get axes(){const e={};return Object.keys(this.#i).forEach((t=>{e[t]=this.getAxis(t)})),e}get frequency(){return this.#a}get period(){return this.#l}get#l(){return 1/this.#a}constructor(e){r(this,"$",{}),e&&this.#m(e),"undefined"==typeof Worker?this.#u={sleep:e=>new Promise((t=>{setTimeout(t,1e3*e)})),now:()=>performance.now()/1e3}:this.#u=new class{#f;#d={};#v=1;constructor(){this.#f=new Worker(this.#x((function(){onmessage=function(e){const{id:t,delay:s}=e.data;setTimeout((()=>{postMessage(t)}),1e3*s)}}))),this.#f.onmessage=({data:e})=>{const t=e;this.#d[t](),delete this.#d[t]}}sleep(e){return new Promise((t=>{const s=this.#v++;this.#d[s]=t,this.#f.postMessage({id:s,delay:e})}))}now(){return performance.now()/1e3}#x(e){const t=new Blob([`(${e.toString()})()`],{type:"text/javascript"});return URL.createObjectURL(t)}}}defaultConfiguration(){return this.#m(h),this}getTimer(){return this.#u}async do(e){this.stop();const t=this.#c++;for(this.#h=t;this.#p;)await this.sleep();for(this.#p=!0;this.#h===t&&!e.complete;)try{await e.perform(this)}catch(e){console.error(`Error performing behavior: ${e}`);break}this.#h===t&&(this.#h=null),this.#p=!1}async move(...e){if(!this.#o||!this.#o.length)throw new Error("No output devices have been added.");this.#g(e);const t=this.#n++;for(this.#r.add(t);this.#r.has(t)&&this.#r.values().next().value!==t;)await this.sleep();return!!this.#r.has(t)&&this.#y(t,e).finally((()=>{this.#r.delete(t)}))}moveBuilder(){return new s(this)}async home(e=.5,t=.5){const s=this.#w().filter((e=>"linear"===e.type||"rotation"===e.type)).map((s=>({to:e,speed:t,axis:s.name})));return s.length?this.move(...s):(console.warn("No linear or rotation axes configured."),Promise.resolve(!1))}stop(){this.#h=null,this.#r.clear()}sleep(e){return this.#u.sleep(e)}configureAxis(e){const t=this.#b(e),s=this.#i[e.name];if(s&&(t.value=s.value,t.lastValue=s.lastValue,delete this.#i[s.alias],delete this.$[s.alias]),this.#i[e.name]=t,this.#A(e.name),e.alias){if(this.#i[e.alias])throw new Error(`Alias already refers to another axis: ${e.alias}`);this.#i[e.alias]=t,this.#A(e.alias)}}getAxis(e){const t=this.#i[e];if(t){const e={};return Object.keys(t).forEach((s=>{r(e,s,t[s])})),e}}updateLimits(e,t,s){const o=e=>!Number.isFinite(e)||e<0||e>1;if(o(t)||o(s)||t===s)throw new Error(`Invalid limits: min = ${t}, max = ${s}`);if(!this.#i[e])throw new Error(`Invalid axis: ${e}`);this.#i[e].min=Math.min(t,s),this.#i[e].max=Math.max(t,s)}addOutputDevice(...e){for(const t of e)if(!(t&&t.write&&t.write instanceof Function))throw new Error(`Invalid device: ${t}`);this.#o.push(...e)}addOutputDevices(...e){this.addOutputDevice(...e)}#A(e){Object.defineProperty(this.$,e,{value:(...t)=>this.moveBuilder()[e](...t),writeable:!1,configurable:!0,enumerable:!0}),Object.defineProperty(this.$[e],"value",{get:()=>this.#i[e].value,set:t=>{const{type:s}=this.#i[e];if("boolean"!==s&&!a(t,0,1))throw new Error(`Invalid value: ${t}`);const o="boolean"===s?!!t:t,i=this.#R(e,o);this.#L(`${i}\n`),this.#i[e].lastValue=this.#i[e].value,this.#i[e].value=o}}),Object.defineProperty(this.$[e],"lastValue",{get:()=>this.#i[e].lastValue}),Object.defineProperty(this.$[e],"min",{get:()=>this.#i[e].min}),Object.defineProperty(this.$[e],"max",{get:()=>this.#i[e].max})}#m(e){this.name=e.name,this.defaultAxis=e.defaultAxis,this.#a=e.frequency||this.#a,e.axes&&e.axes.forEach((e=>{this.configureAxis(e)}))}#L(e){for(const t of this.#o)t.write(e)}async#y(e,t){const s=this.#M(t),{stepCount:o,duration:i}=this.#E(s),a=s.filter((e=>!e.parameters.stepCount)),r=s.filter((e=>!!e.parameters.stepCount));this.#$(a,0);let n=0;const c=this.#u.now();if(o)for(let t=0;t<o;t++){const s=r.filter((e=>t<e.parameters.stepCount));if(this.#$(s,t),n=await this.#P(t,o,i,c,n),!this.#r.has(e))return!1}else await this.sleep(this.#l);return!0}async#P(e,t,s,o,i){const a=e===t-1?s%(this.#u.now()-o):this.#l;return await this.sleep(a-i),this.#u.now()-o-(e+1)*this.#l}#$(e,t){const s=e.map((e=>this.#k(e,t))).filter((({value:e})=>this.#S(e))),o=s.map((({axis:e,value:t})=>this.#R(e,t)));o.length&&(this.#L(`${o.join(" ")}\n`),s.forEach((({axis:e,value:t})=>{this.#i[e].lastValue=this.#i[e].value,this.#i[e].value=t})))}#k(e,t){const s=t*this.#l,{parameters:a,valueProvider:r}=e,{duration:n}=a,c=r({...a,time:s,index:t,period:this.#l,frequency:this.#a,currentValue:this.#i[a.axis].value,x:Math.min(1,(t+1)/(n*this.#a))}),h=null!=c;return!this.#S(c)&&h&&console.warn(`Invalid value provided: ${c}`),{axis:a.axis,value:Number.isFinite(c)?i(o(c,p.precision),0,1):c}}#S(e){return Number.isFinite(e)||"boolean"==typeof e}#R(e,t){let s;if("boolean"==typeof t)s=t?"9999":"0000";else{const{min:a,max:r}=this.#i[e],n=o(.9999*t,4);s=`${i(o(1e4*((r-a)*n+a)),0,9999)}`.padStart(4,"0")}return`${this.#i[e].name}${s}`}#M(e){let t=0;const s=e.map((e=>{const s=e.axis||this.defaultAxis,i={...e,axis:s,from:this.#i[s].value,period:this.#l};if(n(e,"to")){const t=e.to-i.from,s=Math.abs(t);n(e,"duration")?i.speed=o(s/e.duration,p.precision):n(e,"speed")&&(i.duration=o(s/i.speed,p.precision)),i.direction=t>0?1:t<0?-1:0}return n(i,"duration")&&(t=Math.max(i.duration,t)),i})),i=s.reduce(((e,t)=>(e[t.axis]=t,this.#i[t.axis].alias&&(e[this.#i[t.axis].alias]=t),e)),{});return s.forEach((e=>{if(n(e,"sync")){let s=e;for(;n(s,"sync");)s=i[s.sync];e.duration=s.duration||t,n(e,"to")&&(e.speed=o(Math.abs(e.to-e.from)/e.duration,p.precision))}else n(e,"duration")||"boolean"===this.#i[e.axis].type||(e.duration=t);n(e,"duration")&&(e.stepCount=Math.ceil(e.duration*this.#a))})),s.map((e=>{const t={};return n(e,"value")?t.valueProvider=e.value:"boolean"===this.#i[e.axis].type?t.valueProvider=()=>e.to:e.to!==e.from?t.valueProvider=this.defaultRamp:t.valueProvider=()=>{},delete e.sync,delete e.value,t.parameters=e,t}))}#E(e){let t=0,s=0;return e.forEach((e=>{const o=e.parameters.stepCount,i=e.parameters.duration;o&&(t=Math.max(o,t)),i&&(s=Math.max(i,s))})),{stepCount:t,duration:s}}#g(e){const t={};let s=!1,o=!1;e&&e.length||c("Must supply at least one movement."),e.forEach((e=>{e&&"object"==typeof e||c(`Invalid movement: ${e}`);const i=t=>c(`Invalid value for parameter '${t}': ${e[t]}`),a=n(e,"to"),r=n(e,"speed"),h=n(e,"duration"),p=n(e,"value"),u=e.axis||this.defaultAxis;if(u||c("No default axis configured. Must specify an axis for each movement."),n(e,"axis")&&("string"==typeof e.axis&&e.axis.trim()&&this.#i[e.axis]||i("axis")),a){let t=!1;t="boolean"===this.#i[u].type?"boolean"!=typeof e.to:!Number.isFinite(e.to)||e.to<0||e.to>1,t&&i("to")}else p||c("Must provide a 'to' property or 'value' function.");r&&h&&c("Cannot supply both speed and duration."),(r||h)&&(s=!0,r&&(!Number.isFinite(e.speed)||e.speed<=0)?i("speed"):h&&(!Number.isFinite(e.duration)||e.duration<=0)&&i("duration")),r&&!a&&c("Must provide a target position when specifying speed."),p&&"function"!=typeof e.value&&c("'value' must be a function."),n(e,"sync")&&("string"==typeof e.sync&&e.sync.trim()||i("sync"),(n(e,"speed")||n(e,"duration"))&&c(`Cannot specify a speed or duration when sync property is present: ${e.axis}`)),"boolean"!==this.#i[u].type?o=!0:(n(e,"speed")&&c(`Cannot specify speed for boolean axes: ${u}`),n(e,"duration")&&a&&!p&&c("Cannot specify a duration for a boolean axis movement with constant value.")),t[u]&&c(`Duplicate axis movement: ${u}`),t[u]=e,this.#i[u].alias&&(t[this.#i[u].alias]=e)})),e.forEach((e=>{let s=e;const o=e.axis;for(;n(s,"sync");)t[s.sync]||c(`Cannot sync with axis not specified in movement: ${s.axis} -> ${s.sync}`),s=t[s.sync],s.sync===o&&c("Sync axes cannot form a cycle.")})),!s&&o&&c("At least one movement must have a speed or duration.")}#b(e){e&&"object"==typeof e||c(`Invalid configuration object: ${e}`);const t={name:"string",type:"string",alias:"string",max:"number",min:"number"},s=["name","type"].filter((t=>void 0===e[t]||null===e[t])).sort();s.length&&c(`Configuration is missing properties: ${s.join(", ")}`);const o=[];Object.keys(t).forEach((s=>{const i=e[s];null!=i&&(typeof i!==t[s]?o.push(s):"min"!==s&&"max"!==s||(!Number.isFinite(i)||i<0||i>1)&&o.push(s))})),o.length&&c(`Invalid configuration parameter(s): ${o.sort().map((t=>`${t} = ${e[t]}`)).join(", ")}`),-1===["linear","rotation","auxiliary","boolean"].indexOf(e.type)&&c(`Invalid type. Must be linear, rotation, auxiliary, or boolean: ${e.type}`);const i="boolean"!==e.type&&.5,a={...e,max:e.max||1,min:e.min||0,value:i,lastValue:i};return(a.max===a.min||a.min>a.max)&&c(`Invalid configuration parameter(s): max = ${a.max}, min = ${a.min}`),a}#w(){const e={};return Object.values(this.#i).forEach((t=>{e[t.name]=t})),Object.values(e).sort((function(e,t){return e.name>t.name?1:-1}))}static RAMP_LINEAR({to:e,from:t,x:s}){return t+(e-t)*s}static RAMP_COS({to:e,from:t,x:s}){return t+(e-t)*(-Math.cos(Math.PI*s)/2+.5)}static RAMP_PARABOLIC({to:e,from:t,x:s}){return(e-t)*s*s+t}static RAMP_NEGATIVE_PARABOLIC({to:e,from:t,x:s}){return(e-t)*(1-(s-1)**2)+t}static tempestMotion(e,t,s=0,o=0,i=60,a=0){this.#I(e,t,s,o,i,a);const n=2*Math.PI*i/60,c=.5*(t-e),h=.5*(t+e),p=({index:e,frequency:t})=>{const i=e*n/t+a;return h-c*Math.cos(i+.5*Math.PI*s+o*Math.sin(i))};return r(p,"from",e),r(p,"to",t),r(p,"phase",s),r(p,"ecc",o),r(p,"bpm",i),p}static#I(e,t,s,o,i,r){if(!(a(e,0,1)&&a(t,0,1)&&a(s)&&a(o)&&a(i)&&i>0&&a(r)))throw new Error(`One or more stroke parameters are invalid (${e}, ${t}, ${s}, ${o}, ${i}, ${r})`)}static blendMotion(e,t,s){return(...i)=>o((1-s)*e(...i)+s*t(...i),p.precision)}static get defaultConfiguration(){return{...h}}}const u=p,l=class{#O=[];#F=!1;get complete(){return this.#F}generateActions(e){throw new Error("Behavior does not implement generateActions()")}emitActions(e=1,t=null){for(let s=0;s<e;s++)this.generateActions(t);return this.#O.splice(0,this.#O.length)}async perform(e){if(this.#O.length||this.generateActions(e),!this.#O.length)throw new Error("Behavior did not generate any actions.");const{type:t,value:o}=this.#O.shift();if("function"===t&&o instanceof Function)return o.call(void 0,this,e);if("sleep"===t&&Number.isFinite(o)&&o>=0)return e.sleep(o);if("move"===t&&o instanceof s)return o.execute();if("move"===t&&o instanceof Array)return e.move(...o);throw new Error(`Invalid action: (${t}, ${o})`)}queueMove(...e){const t=e[0]instanceof s?e[0]:e;this.#q({type:"move",value:t})}queueSleep(e){this.#q({type:"sleep",value:e})}queueFunction(e){this.#q({type:"function",value:e})}queueBehavior(e,t=1,s=null){this.#j(e.emitActions(t,s))}queueComplete(){this.queueFunction((()=>{this.#F=!0}))}insertMove(...e){const t=e[0]instanceof s?e[0]:e;this.#C({type:"move",value:t})}insertSleep(e){this.#C({type:"sleep",value:e})}insertFunction(e){this.#C({type:"function",value:e})}insertBehavior(e,t=1,s=null){this.#T(e.emitActions(t,s))}insertComplete(){this.insertFunction((()=>{this.#F=!0}))}#q(e){this.#O.push(e)}#j(e){this.#O.splice(this.#O.length,0,...e)}#C(e){this.#O.unshift(e)}#T(e){this.#O.splice(0,0,...e)}};class m{#B=0;#V;constructor(e){this.#V=e}next(){return this.#V(this.#B++)}get index(){return this.#B}static createFrom(e){return new m(e instanceof Array?t=>e[t%e.length]:"function"!=typeof e?()=>e:e)}}class f extends l{#N;#_;#D;#U;#W;get speed(){return this.#D}get top(){return this.#N}get bottom(){return this.#_}get duration(){return this.#U}static get DEFAULT_CONFIG(){return{top:1,bottom:0,speed:1,shape:u.RAMP_COS,relativeSpeeds:[1,1],suck:null,twist:null}}constructor(e=0,t=1,s=1,o=u.RAMP_COS){let i;super(),i="object"!=typeof e||e instanceof Array?{top:t,bottom:e,speed:s,shape:o}:e,this.#G(i)}generateActions(e){this.queueFunction((t=>{const{value:s,lastValue:o}=e.$.stroke,{target:i,shape:r,direction:n,relativeSpeed:c}=this.#J(s,o),h=this.#D*c,p={to:i,value:r};void 0!==this.#W.speed?(p.speed=h,this.#D=this.#W.speed.next()):(p.duration=this.#U/c,this.#U=this.#W.duration.next());const u=[p];this.#W.twist&&u.push(this.#Z({direction:n,value:s,target:i,ayva:e,speed:void 0!==this.#W.speed?h:Math.abs(i-s)/p.duration})),t.insertMove(...u),a(this.#W.suck,0,1)&&(e.$.suck.value=this.#W.suck)}))}#G(e){const t=f.DEFAULT_CONFIG;n(e,"duration")&&delete t.speed;const s={...t,...e};this.#z(s),s.top=m.createFrom(s.top),s.bottom=m.createFrom(s.bottom),s.relativeSpeeds=m.createFrom(s.relativeSpeeds),n(s,"duration")?s.duration=m.createFrom(s.duration):s.speed=m.createFrom(s.speed);const{shape:o}=s;s.shape=new m(o instanceof Array?e=>o[e%o.length]:()=>o),this.#W=s,this.#N=this.#W.top.next(),this.#_=this.#W.bottom.next(),void 0!==this.#W.speed?this.#D=this.#W.speed.next():this.#U=this.#W.duration.next()}#Z({direction:e,value:t,target:s,speed:o,ayva:i}){const{frequency:a}=i,r=("up"===e?0:2)+(this.#W.twist.phase||0),n=60*o/(2*Math.abs(t-s)),c=u.tempestMotion(this.#W.twist.from,this.#W.twist.to,r,0,n),h=c({index:0,frequency:a});return Math.abs(h-i.$.twist.value)>.05?{axis:"twist",to:u.tempestMotion(this.#W.twist.from,this.#W.twist.to,r+2,0,n)({index:0,frequency:a}),value:u.RAMP_COS}:{axis:"twist",value:c}}#J(e,t){const s=e-t>=0,o=this.#W.shape.index%2==0?"up":"down",i=this.#W.relativeSpeeds.index%2==0?"up":"down";let a,r;return e<=this.#_||e<this.#N&&!s?(r="up",a=this.#N,this.#N=this.#W.top.next(),"down"===o&&this.#W.shape.next(),"down"===i&&this.#W.relativeSpeeds.next()):(r="down",a=this.#_,this.#_=this.#W.bottom.next(),"up"===o&&this.#W.shape.next(),"up"===i&&this.#W.relativeSpeeds.next()),{target:a,shape:this.#W.shape.next(),direction:r,relativeSpeed:this.#W.relativeSpeeds.next()}}#z(e){const t=(e,t)=>{throw new Error(`Invalid stroke ${e}: ${t}`)};if(a(e.bottom,0,1)||"function"==typeof e.bottom||e.bottom instanceof Array||t("bottom",e.bottom),a(e.top,0,1)||"function"==typeof e.top||e.top instanceof Array||t("top",e.top),e.bottom===e.top)throw new Error(`Invalid stroke range specified: (${e.bottom}, ${e.top})`);if(n(e,"speed")&&n(e,"duration"))throw new Error("Cannot specify both a speed and duration");if(!n(e,"speed")||a(e.speed)&&!(e.speed<=0)||"function"==typeof e.speed||e.speed instanceof Array||t("speed",e.speed),!n(e,"duration")||a(e.duration)&&!(e.duration<=0)||"function"==typeof e.duration||e.duration instanceof Array||t("duration",e.duration),"function"==typeof e.shape||e.shape instanceof Array||t("shape",e.shape),!n(e,"relativeSpeeds")||e.relativeSpeeds instanceof Array||t("relative speeds",e.relativeSpeeds),"object"!=typeof e.twist&&t("twist",e.twist),e.twist&&(a(e.twist.from,0,1)||t("twist from",e.twist.from),a(e.twist.to,0,1)||t("twist to",e.twist.to),n(e.twist,"phase")&&!a(e.twist.phase)&&t("twist phase",e.twist.phase)),e.shape instanceof Array){if(!e.shape.length)throw new Error("Missing stroke shape.");if(e.shape.length%2!=0)throw new Error("Must specify an even number of stroke shapes.");e.shape.forEach((e=>{"function"!=typeof e&&t("shape",e)}))}if(e.relativeSpeeds instanceof Array){if(e.relativeSpeeds.length%2!=0)throw new Error("Must specify an even number of relative speeds.");e.relativeSpeeds.forEach((e=>{(!a(e)||e<=0)&&t("relative speed",e)}))}n(e,"suck")&&!a(e.suck,0,1)&&null!==e.suck&&t("suck",e.suck)}}const d=f,v=[{name:"down-forward",L0:{from:0,to:1,phase:0,ecc:.5},L1:{from:.8,to:.2,phase:1,ecc:.8},L2:{from:.5,to:.5,phase:0,ecc:0},R0:{from:.5,to:.5,phase:0,ecc:0},R1:{from:.5,to:.5,phase:0,ecc:0},R2:{from:.2,to:.8,phase:1,ecc:.8}},{name:"down-backward",L0:{from:0,to:1,phase:0,ecc:.5},L1:{from:.2,to:.8,phase:1,ecc:.8},L2:{from:.5,to:.5,phase:0,ecc:0},R0:{from:.5,to:.5,phase:0,ecc:0},R1:{from:.5,to:.5,phase:0,ecc:0},R2:{from:.8,to:.2,phase:1,ecc:.8}},{name:"back-thrust-down",L0:{from:0,to:.7,phase:0,ecc:.5},L1:{from:1,to:0,phase:0,ecc:.5},L2:{from:.5,to:.5,phase:0,ecc:0},R0:{from:.5,to:.5,phase:0,ecc:0},R1:{from:.5,to:.5,phase:0,ecc:0},R2:{from:.4,to:1,phase:0,ecc:.5}},{name:"back-thrust-down-swirl",L0:{from:0,to:.7,phase:0,ecc:.5},L1:{from:.9,to:.1,phase:0,ecc:.5},L2:{from:.8,to:.2,phase:1,ecc:.5},R0:{from:.5,to:.5,phase:0,ecc:0},R1:{from:.8,to:.2,phase:1,ecc:.5},R2:{from:.5,to:1,phase:0,ecc:.5}},{name:"thrust-forward",L0:{from:0,to:.5,phase:0,ecc:.5},L1:{from:.2,to:1,phase:0,ecc:.5},L2:{from:.5,to:.5,phase:0,ecc:0},R0:{from:.5,to:.5,phase:0,ecc:0},R1:{from:.5,to:.5,phase:0,ecc:0},R2:{from:.5,to:1,phase:0,ecc:.5}},{name:"thrust-forward-swirl",L0:{from:0,to:.5,phase:0,ecc:.5},L1:{from:.2,to:1,phase:0,ecc:.5},L2:{from:.8,to:.2,phase:1,ecc:0},R0:{from:.5,to:.5,phase:0,ecc:0},R1:{from:.8,to:.2,phase:1,ecc:0},R2:{from:.5,to:1,phase:0,ecc:.5}},{name:"lean-forward-thrust-down",L0:{from:0,to:.7,phase:0,ecc:.5},L1:{from:.5,to:.5,phase:0,ecc:0},L2:{from:.5,to:.5,phase:0,ecc:0},R0:{from:.5,to:.5,phase:0,ecc:0},R1:{from:.5,to:.5,phase:0,ecc:0},R2:{from:1,to:0,phase:0,ecc:.5}},{name:"lean-forward-thrust-down-swirl",L0:{from:0,to:.7,phase:0,ecc:.5},L1:{from:.5,to:.5,phase:0,ecc:0},L2:{from:.8,to:.2,phase:1,ecc:.5},R0:{from:.5,to:.5,phase:0,ecc:0},R1:{from:.8,to:.2,phase:1,ecc:.5},R2:{from:1,to:0,phase:0,ecc:.5}},{name:"diagonal-down-back",L0:{from:0,to:.5,phase:0,ecc:.2},L1:{from:1,to:.2,phase:0,ecc:.2},L2:{from:.5,to:.5,phase:0,ecc:0},R0:{from:.5,to:.5,phase:0,ecc:0},R1:{from:.5,to:.5,phase:0,ecc:0},R2:{from:1,to:0,phase:1,ecc:.6}},{name:"diagonal-down-forward",L0:{from:0,to:.5,phase:0,ecc:.2},L1:{from:0,to:.8,phase:0,ecc:.2},L2:{from:.5,to:.5,phase:0,ecc:0},R0:{from:.5,to:.5,phase:0,ecc:0},R1:{from:.5,to:.5,phase:0,ecc:0},R2:{from:0,to:1,phase:1,ecc:.6}},{name:"orbit-tease",L0:{from:.8,to:1,phase:0,ecc:.3},L1:{from:.9,to:.1,phase:0,ecc:-.3},L2:{from:.1,to:.9,phase:1,ecc:-.3},R0:{from:.5,to:.5,phase:0,ecc:0},R1:{from:.1,to:.9,phase:1,ecc:-.3},R2:{from:.1,to:.9,phase:0,ecc:-.3}},{name:"left-right-tease",L0:{from:.9,to:.9,phase:0,ecc:0},L1:{from:.5,to:.5,phase:0,ecc:0},L2:{from:0,to:1,phase:0,ecc:0},R0:{from:.5,to:.5,phase:0,ecc:0},R1:{from:1,to:0,phase:1,ecc:0},R2:{from:.5,to:.5,phase:0,ecc:0}},{name:"forward-back-tease",L0:{from:.9,to:.9,phase:0,ecc:0},L1:{from:0,to:1,phase:0,ecc:0},L2:{from:.5,to:.5,phase:0,ecc:0},R0:{from:.5,to:.5,phase:0,ecc:0},R1:{from:.5,to:.5,phase:0,ecc:0},R2:{from:0,to:1,phase:1,ecc:0}},{name:"vortex-tease",L0:{from:.8,to:1,phase:0,ecc:.3},L1:{from:.6,to:.4,phase:0,ecc:0},L2:{from:.4,to:.6,phase:1,ecc:0},R0:{from:.5,to:.5,phase:0,ecc:0},R1:{from:.9,to:.1,phase:1,ecc:0},R2:{from:.9,to:.1,phase:0,ecc:0}},{name:"swirl-tease",L0:{from:.5,to:1,phase:0,ecc:0},L1:{from:1,to:.3,phase:0,ecc:0},L2:{from:1,to:0,phase:1,ecc:0},R0:{from:.5,to:.5,phase:0,ecc:0},R1:{from:.9,to:.1,phase:1,ecc:0},R2:{from:.4,to:1,phase:0,ecc:0}},{name:"forward-back-grind",L0:{from:0,to:0,phase:0,ecc:0},L1:{from:.3,to:.7,phase:0,ecc:0},L2:{from:.5,to:.5,phase:0,ecc:0},R0:{from:.5,to:.5,phase:0,ecc:0},R1:{from:.5,to:.5,phase:0,ecc:0},R2:{from:0,to:1,phase:.5,ecc:0}},{name:"orbit-grind",L0:{from:0,to:.3,phase:0,ecc:.3},L1:{from:0,to:.6,phase:0,ecc:-.3},L2:{from:.2,to:.8,phase:1,ecc:-.3},R0:{from:.5,to:.5,phase:0,ecc:0},R1:{from:.1,to:.9,phase:1,ecc:-.3},R2:{from:.9,to:.1,phase:0,ecc:-.3}}].reduce(((e,t)=>{const{name:s}=t;return delete t.name,e[s]=t,e}),{});class x extends l{#H;#K;#Q;get angle(){return this.#H}get bpm(){return this.#K}static get DEFAULT_PARAMETERS(){return{from:0,to:1,phase:0,ecc:0,shift:0}}static get library(){return JSON.parse(JSON.stringify(v))}constructor(e,t=60){if(super(),"string"==typeof e){if(!n(v,e))throw new Error(`No stroke named ${e} found.`);e=v[e]}r(this,"axes",{}),Object.keys(e).forEach((t=>{r(this.axes,t,{}),Object.keys(e[t]).forEach((s=>{r(this.axes[t],s,e[t][s])})),Object.keys(x.DEFAULT_PARAMETERS).forEach((s=>{n(e[t],s)||r(this.axes[t],s,x.DEFAULT_PARAMETERS[s])}))})),this.#H=0,this.#Q=m.createFrom(t),this.#K=this.#Q.next()}generateActions(){this.queueFunction((e=>{const t=Object.keys(this.axes).map((e=>{const t=this.axes[e];return{axis:e,value:u.tempestMotion(t.from,t.to,t.phase,t.ecc,this.#K,t.shift+this.#H),duration:30/this.#K}}));e.insertMove(...t),this.#H+=Math.PI,this.#K=this.#Q.next()}))}getTransitionMoves(e,t){const s={};return t&&(n(t,"speed")||n(t,"duration"))||(s.speed=1),Object.keys(this.axes).map((o=>{const i=this.axes[o];return{axis:o,to:u.tempestMotion(i.from,i.to,i.phase,i.ecc,this.#K,i.shift+this.#H)({index:0,frequency:e.frequency}),...s,...t}}))}}const g=x,y=class{#X;#Y;constructor(e,t){if(a(e,0)&&void 0===t)this.#Y=1e3*e;else{if(!(a(e,0)&&a(t,0)&&e<t))throw new Error(`Invalid duration range: (${e}, ${t})`);this.#Y=1e3*(Math.random()*(t-e)+e)}this.#X=performance.now()}get targetElapsed(){return this.#Y}get complete(){return performance.now()-this.#X>=this.#Y}get percentage(){return i((performance.now()-this.#X)/this.#Y,0,1)}},w=class{#ee;#te=!1;#se=null;#oe=null;#ie=null;get connected(){return this.#te}constructor(e=115200,t=null){this.#ee=e,this.#ie=t||(globalThis.navigator?globalThis.navigator.serial:null)}async requestConnection(){const e=await this.#ie.requestPort();await e.open({baudRate:this.#ee});const t=new TextEncoderStream;t.readable.pipeTo(e.writable);const s=new TextDecoderStream;e.readable.pipeTo(s.writable),this.#se=t.writable.getWriter(),this.#oe=s.readable.getReader(),this.#te=!0;const o=t=>{t.target===e&&(this.#te=!1,this.#ie.removeEventListener("disconnect",o))};return this.#ie.addEventListener("disconnect",o),new Promise((e=>{setTimeout(e,2e3)}))}write(e){if(!this.#te)throw new Error("No device connected.");this.#se.write(e)}};var b=t.UE,A=t.fV,R=t.ft,L=t.ni,M=t._I,E=t.ZP;export{b as AyvaBehavior,A as ClassicStroke,R as TempestStroke,L as VariableDuration,M as WebSerialDevice,E as default};